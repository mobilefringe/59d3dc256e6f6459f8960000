<div class="home_banner">   
    <div class="flexslider">
        <ul class="slides" id="home_banner">
            <script id="banner_template" type="x-tmpl-mustache/text">
                <li>
                    <a href="{{url}}" {{css}} onclick="{{noLink}}">
                        <img alt="banner" src="{{image_url}}" />
                    </a>
                </li>
            </script>
        </ul>
    </div>
</div>
<div class="content_container">
    <!--<div class="flex_container">-->
    <!--    <div id="feature_container">-->
    <!--        <script id="feature_template" type="x-tmpl-mustache/text">-->
    <!--            <div class="width_30">-->
    <!--                <a href="{{url}}">-->
    <!--                    <img src="{{image_url}}" alt="{{name}}"/>-->
    <!--                </a>-->
    <!--            </div>-->
    <!--        </script>-->
    <!--    </div>-->
    <!--</div>-->
    <div class="flex_container">
        <div class="width_30">
            <a href="/stores">
                <img src="//codecloud.cdn.speedyrails.net/sites/59d3dc256e6f6459f8960000/image/png/1507748821000/shop.png" alt=""/>
            </a>
        </div>
        <div class="width_30">
            <a href="/promotions">
                <img src="//codecloud.cdn.speedyrails.net/sites/59d3dc256e6f6459f8960000/image/png/1507748796000/promotions.png" alt="{{name}}"/>
            </a>
        </div>
        <div class="width_30">
            <a href="/find_us">
                <img src="//codecloud.cdn.speedyrails.net/sites/59d3dc256e6f6459f8960000/image/png/1507748792000/location.png" alt="{{name}}"/>
            </a>
        </div>
    </div>
    <div class="flex_container">
        <div class="width_50">
            <img src="//codecloud.cdn.speedyrails.net/sites/59d3dc256e6f6459f8960000/image/png/1508261351000/feature1.png" class="" alt="">
        </div>
        <div class="width_50">
            <div class="home_promos">
                <h2 class="details_title">Restaurants</h2>
                <div id="home_dine_container" class="dine_container">
                    <script id="home_dine_template" type="x-tmpl-mustache/text">
                        <div class="margin_30">
                            <h2 class="home_promo_name"> {{name}} </h2>
                            <p class="home_promo_dates"> {{phone}} | Level {{z_coordinate}} </p>
                            <a class="home_read_more" href="/stores/{{slug}}"><p>See Details</p></a>
                        </div>
                    </script>
                </div>
                <p class="home_see_all"><a href="/dine">See all restaurants </a> <i class="fa fa-angle-right" aria-hidden="true"></i></p>
            </div>
        </div>
    </div>
    <div class="flex_container">
        <div class="width_50">
            <div class="home_promos">
                <div id="home_promo_container">
                    <script id="home_promo_template" type="x-tmpl-mustache/text">
                        <div class="margin_30">
                            <p class="home_promo_store"> {{store_name}} </p>
                            <h2 class="home_promo_name"> {{name}} </h2>
                            <p class="home_promo_dates"> {{dates}} </p>
                            <p class="home_promo_desc"> {{short_desc}} </p>
                            <a class="home_read_more" href="/promotions/{{slug}}"><p>Read More</p></a>
                        </div>
                    </script>
                </div>
                <p class="home_see_all"><a href="/promotions">See all sales & promotions</a> <i class="fa fa-angle-right" aria-hidden="true"></i></p>
            </div>
        </div>
        <div class="width_50">
            <img src="//codecloud.cdn.speedyrails.net/sites/59d3dc256e6f6459f8960000/image/png/1508261370000/feature2.png" class="" alt="">
        </div>
    </div>
    <div class="logo_scroll">
        <div id="logo_slider" class="flexslider">
            <ul class="slides" id="scroll_container">
                <script id="scroll_template" type="x-tmpl-mustache/text">
                    <li>
                        <a href="{{url}}" {{css}} onclick="{{noLink}}">
                            <img alt="banner" src="{{image_url}}" />
                        </a>
                    </li>
                </script>
            </ul>
        </div>
    </div> 
</div>
<script>
    $(document).ready(function(e) {
        init(e);
        function renderAll (){
            var banners = getBanners();
            renderBanner('#banner_template','#home_banner', banners);
            // var feature_items = getFeatureList();
            // var feature_items = getRepoDetailsByName("Feature Item Test").images
            // console.log(feature_items)
            // // renderFeatureItems('#feature_container','#feature_template', feature_items);
            // renderGeneral('#feature_container','#feature_template', feature_items);
            
            // RESTAURANTS //
            var restaurants = getStoresListByCategoryID(2538);
            console.log(restaurants)
            renderStoreList('#home_dine_container','#home_dine_template', restaurants, "stores");
            
            // PROMOS //
            var promotions = getPromotionsList().sortBy(function(o){ return o.end_date });
            var published_promos = [];
            $.each(promotions, function(key, val){
                today = moment();
                webDate = moment(val.show_on_web_date)
                if (today.tz(getPropertyTimeZone()) >= webDate.tz(getPropertyTimeZone())) {
                    published_promos.push(val);
                }
            });
            if(published_promos.length > 0){
                var featured_promos = published_promos.slice(0, 3);
                renderPromotions("#home_promo_container", "#home_promo_template", featured_promos);
            } else {
                $('#no_promos').show();
            }
            
            // BLOG //
            // var blog_posts = getBlogDataBySlug("twinpines-main").posts.reverse();
            // if(blog_posts.length > 0){
            //     var featured_posts = blog_posts.slice(0, 3);
            //     renderPosts("#home_blog_container", "#home_blog_template", featured_posts)
            // }
            
            // LOGO SCROLL //
            var stores = getStoresList();
            var featured_logos = [];
            $.each(stores, function(key, val){
                if(val.show_logo != false){
                    featured_logos.push(val);
                }
            });
            renderLogoScroll('#scroll_container','#scroll_template', featured_logos);
           
            function renderLogoScroll(container, template, collection){
                var item_list = [];
                var item_rendered = [];
                var template_html = $(template).html();
                Mustache.parse(template_html); 
                $.each( collection , function( key, val ) {
                    if(val.show_logo != false){
                        val.image_url = val.store_front_url_abs;
                    }
                    var repo_rendered = Mustache.render(template_html,val);
                    item_rendered.push(repo_rendered);
                });
                $(container).html(item_rendered.join(''));
            }     
            
            show_content();
            
            $('.flexslider').flexslider({
                animation: "slide",
            });
            
            $('#logo_slider').flexslider({
                animation: "slide",
                itemWidth: 200,
                minItems: 5,
                maxItems: 5
            });
        }
        loadMallDataCached(renderAll); 
    })
</script>